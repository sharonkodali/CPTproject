<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Add any necessary meta tags, styles, and other head elements -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Page Title</title>
</head>
<body>

    <form action="javascript:login_user()">
        <p><label>
            User ID:
            <input type="text" name="uid" id="uid" required>
        </label></p>
        <p><label>
            Password:
            <input type="password" name="password" id="password" required>
        </label></p>
        <p>
            <button>Login</button>
        </p>
    </form>

    <script type="module">
        // uri variable and options object are obtained from config.js
        import { uri, options } from '{{site.baseurl}}/assets/js/api/config.js';

        function login_user(){
            // Set Authenticate endpoint
            const url = uri + '/api/users/authenticate';

            // Set body of request to include login data from DOM
            const body = {
                uid: document.getElementById("uid").value,
                password: document.getElementById("password").value,
            };

            // Change options according to Authentication requirements
            const authOptions = {
                ...options, // This will copy all properties from options
                method: 'POST', // Override the method property
                cache: 'no-cache', // Set the cache property
                body: JSON.stringify(body)
            };

            // Fetch JWT
            fetch(url, authOptions)
            .then(response => {
                // handle error response from Web API
                if (!response.ok) {
                    if (response.status === 401) {
                        // Unauthorized - Redirect to 401 error page
                        window.location.href = "{{site.baseurl}}/errors/401.html";
                    } else if (response.status === 403) {
                        // Forbidden - Redirect to 403 error page
                        window.location.href = "{{site.baseurl}}/errors/403.html";
                    } else if (response.status === 404) {
                        // Not Found - Redirect to 404 error page
                        window.location.href = "{{site.baseurl}}/error/404.html";
                    } else {
                        // Handle other error responses
                        const errorMsg = 'Login error: ' + response.status;
                        console.log(errorMsg);
                    }
                    return;
                }
                // Success!!!
                // Redirect to the database page
                window.location.href = "{{site.baseurl}}/data/database";
            })
            // catch fetch errors (ie ACCESS to server blocked)
            .catch(err => {
                console.error(err);
            });
        }

        // Attach login_user to the window object, allowing access to form action
        window.login_user = login_user;
    </script>

</body>
</html>

